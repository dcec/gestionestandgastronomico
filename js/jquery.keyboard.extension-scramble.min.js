/* jQuery UI Virtual Keyboard Scramble Extension v1.3 for Keyboard v1.18+ (updated 7/18/2014)
 * By Rob Garrison ~ MIT license ~ https://github.com/Mottie/Keyboard */
;(function(d){d.keyboard=d.keyboard||{};d.fn.addScramble=function(s){var t={targetKeys:/[a-z\d]/i,byRow:!0,byKeySet:!1,randomizeOnce:!0};return this.each(function(){var e,a=d(this).data("keyboard"),b=a.options;a&&!a.scramble_options&&(e=a.scramble_options=d.extend({},t,s),a.scramble_setup=function(g){var p,k,q,c,b,l,f,n,r,m,h;p=g.find(".ui-keyboard-keyset");if(g.length){e.byKeySet&&(p=p.eq(0));for(k=0;k<p.length;k++)if(q=p.eq(k),f=0,h=[],r=[],n=[],m=[],q.children("button, span, br").each(function(){"BR"=== this.tagName?(e.byRow?(h.push(this),r.push(!1),m[f]=h,n[f]=r,h=[],r=[]):(m[f]=this,n[f]=!1),f++):(l=d(this).attr("data-value")||"",l=1===l.length&&e.targetKeys.test(l)?l:!1,e.byRow?(h.push(this),r.push(l)):(m[f]=this,n[f]=l,f++))}),q.find(".ui-keyboard-button-endrow").remove(),e.byRow)for(b=0;b<m.length;b++)for(h=a.shuffle(m[b],n[b]),c=0;c<h.length;c++)q.append(h[c]);else for(h=a.shuffle(m,n),c=0;c<h.length;c++)q.append(h[c]);e.byKeySet&&(g=a.realign(g));return g}},a.shuffle=function(a,d){for(var k, b,c=a.length;0<c;)b=Math.floor(Math.random()*c),!1===d[c-1]&&c--,!1!==d[c-1]&&!1!==d[b]&&(c--,k=a[c],a[c]=a[b],a[b]=k);return a},a.realign=function(a){var b,k,e,c=a.find(".ui-keyboard-keyset"),s=c.eq(0),c=c.filter(":gt(0)");s.children().each(function(a,f){k="BR"===f.tagName;e=d(f).attr("data-pos");c.each(function(a,c){b=k?"br:first":'button[data-pos="'+e+'"]';d(c).find(b).appendTo(c)})});return a},b.create=function(){var g=b.layout;d.keyboard.builtLayouts[g]={mappedKeys:{},acceptedKeys:[],$keyboard:null}; "undefined"===typeof d.keyboard.builtLayouts[a.orig_layout]&&(a.layout=b.layout=a.orig_layout,a.buildKeyboard(),a.layout=b.layout=g);d.keyboard.builtLayouts[g]=d.extend(!0,{},d.keyboard.builtLayouts[a.orig_layout]);e.randomizeOnce&&(d.keyboard.builtLayouts[g].$keyboard=a.scramble_setup(d.keyboard.builtLayouts[a.orig_layout].$keyboard.clone()));a.$keyboard=d.keyboard.builtLayouts[g].$keyboard;e.randomizeOnce||a.$el.bind("beforeVisible.keyboard",function(a,b){b.$keyboard=b.scramble_setup(b.$keyboard)})}, a.orig_layout=b.layout,b.layout="scrambled"+Math.round(1E4*Math.random()),b.alwaysOpen&&a.$keyboard.length&&setTimeout(function(){a.$keyboard=a.scramble_setup(a.$keyboard)},0))})}})(jQuery);
